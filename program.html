<!DOCTYPE html>
<html>

<head>
    <title>
        Nanonaut Action
    </title>
</head>

<body>
    <script>

        //CONSTANTS
        var CANVAS_WIDTH = 800;
        var CANVAS_HIEGHT = 600;
        var PLAYER_WIDTH = 181;
        var PLAYER_HEIGHT = 229;
        var PLAYER_X_SPEED = 5;
        var GROUND_Y = 540;
        var PLAYER_Y_ACCELERATION = 1;
        var PLAYER_JUMP_SPEED = 20;
        var SPACE_KEYCODE = 32;
        var BACKGROUND_WIDTH = 1000;
        var PLAYER_NR_FRAMES_PER_ROW = 5;
        var PLAYER_NR_ANIMATION_FRAMES = 7;

        //SETUP
        var canvas = document.createElement('canvas');
        var c = canvas.getContext('2d');
        canvas.width = CANVAS_WIDTH;
        canvas.height = CANVAS_HIEGHT;
        document.body.appendChild(canvas);

        var playerImage = new Image();
        playerImage.src = 'visuals/AnimatedNanonaut.png';

        var backgroundImage = new Image();
        backgroundImage.src = 'visuals/background.png';

        var playerX = CANVAS_WIDTH / 2;
        var playerY = GROUND_Y - PLAYER_HEIGHT;
        var playerYSpeed = 0;
        var spaceKeyIsPressed = false;
        var playerIsInTheAir = false;
        var cameraX = 0;
        var cameraY = 0;
        var playerFrameNr = 0;

        window.addEventListener('keydown', onKeyDown);
        window.addEventListener('keyup', onKeyUp);

        window.addEventListener('load', start);

        function start() {
            window.requestAnimationFrame(mainLoop);
        }

        //MAIN LOOP
        function mainLoop() {
            update();
            draw();
            window.requestAnimationFrame(mainLoop);

            // setTimeout(mainLoop, 1000);
        }

        //PLAYER INPUT
        function onKeyDown(event) {
            if (event.keyCode === SPACE_KEYCODE) {
                spaceKeyIsPressed = true;
            }
        }
        function onKeyUp(event) {
            if (event.keyCode === SPACE_KEYCODE) {
                spaceKeyIsPressed = false;
            }
        }

        //UPDAING
        function update() {
            //SPEEED
            playerX = playerX + PLAYER_X_SPEED;
            console.log(playerX);

            //jump for mr Nano.
            if (spaceKeyIsPressed && !playerIsInTheAir) {
                playerYSpeed = - PLAYER_JUMP_SPEED;
                playerIsInTheAir = true;
            }

            //gravity for mr. Nano
            playerY = playerY + playerYSpeed;

            playerYSpeed = playerYSpeed + PLAYER_Y_ACCELERATION;

            if (playerY > (GROUND_Y - PLAYER_HEIGHT)) {
                playerY = GROUND_Y - PLAYER_HEIGHT;
                playerYSpeed = 0;
                playerIsInTheAir = false;
            }

            //Update animation
            playerFrameNr = playerFrameNr + 1;
            if (playerFrameNr >= PLAYER_NR_ANIMATION_FRAMES) {
                playerFrameNr = 0;
            }

            //Update camera
            cameraX = playerX - 150;
        }

        //DRAWING
        function draw() {
            //Da sky
            c.fillStyle = 'LightSkyBlue';
            c.fillRect(0, 0, CANVAS_WIDTH, GROUND_Y - 40);

            //Da background
            var backgroundX = - (cameraX % BACKGROUND_WIDTH);
            c.drawImage(backgroundImage, backgroundX, -210);
            c.drawImage(backgroundImage, backgroundX + BACKGROUND_WIDTH, -210);

            //Da ground
            c.fillStyle = 'ForestGreen';
            c.fillRect(0, GROUND_Y - 40, CANVAS_WIDTH, CANVAS_HIEGHT - GROUND_Y + 40);

            //drawing mr Nano
            var playerSpriteSheetRow = Math.floor(playerFrameNr / PLAYER_NR_FRAMES_PER_ROW);
            var playerSpriteSheetColumn = playerFrameNr % PLAYER_NR_FRAMES_PER_ROW;
            var playerSpriteSheetX = playerSpriteSheetColumn * PLAYER_WIDTH;
            var playerSpriteSheetY = playerSpriteSheetRow * PLAYER_HEIGHT;
            c.drawImage(playerImage, playerSpriteSheetX, playerSpriteSheetY, PLAYER_WIDTH, PLAYER_HEIGHT, playerX - cameraX, playerY - cameraY, PLAYER_WIDTH, PLAYER_HEIGHT)
        }

    </script>
</body>

</html>