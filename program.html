<!DOCTYPE html>
<html>

<head>
    <title>
        Nanonaut Action
    </title>
</head>

<body>
    <script>

        //CONSTANTS
        var CANVAS_WIDTH = 800;
        var CANVAS_HIEGHT = 600;
        var PLAYER_WIDTH = 181;
        var PLAYER_HEIGHT = 229;
        var GROUND_Y = 540;
        var PLAYER_Y_ACCELERATION = 1;
        var PLAYER_JUMP_SPEED = 20;
        var SPACE_KEYCODE = 32;

        //SETUP
        var canvas = document.createElement('canvas');
        var c = canvas.getContext('2d');
        canvas.width = CANVAS_WIDTH;
        canvas.height = CANVAS_HIEGHT;
        document.body.appendChild(canvas);

        var playerImage = new Image();
        playerImage.src = 'visuals/Nanonaut.png';

        var backgroundImage = new Image();
        backgroundImage.src = 'visuals/background.png';

        var playerX = 50;
        var playerY = 40;
        var playerYSpeed = 0;
        var spaceKeyIsPressed = false;
        var playerIsInTheAir = false;

        window.addEventListener('keydown', onKeyDown);
        window.addEventListener('keyup', onKeyUp);

        window.addEventListener('load', start);

        function start() {
            window.requestAnimationFrame(mainLoop);
        }

        //MAIN LOOP
        function mainLoop() {
            update();
            draw();
            window.requestAnimationFrame(mainLoop);

            // setTimeout(mainLoop, 1000);
        }

        //PLAYER INPUT
        function onKeyDown(event) {
            if (event.keyCode === SPACE_KEYCODE) {
                spaceKeyIsPressed = true;
            }
        }
        function onKeyUp(event) {
            if (event.keyCode === SPACE_KEYCODE) {
                spaceKeyIsPressed = false;
            }
        }

        //UPDAING
        function update() {
            //jump for mr Nano.
            if (spaceKeyIsPressed && !playerIsInTheAir) {
                playerYSpeed = - PLAYER_JUMP_SPEED;
                playerIsInTheAir = true;
                console.log('hello world');
            }
            //gravity for mr. Nano
            playerY = playerY + playerYSpeed;
            console.log('playerY', playerY);

            playerYSpeed = playerYSpeed + PLAYER_Y_ACCELERATION;

            if (playerY > (GROUND_Y - PLAYER_HEIGHT)) {
                playerY = GROUND_Y - PLAYER_HEIGHT;
                playerYSpeed = 0;
                playerIsInTheAir = false;
                console.log('stop jump', playerY);
            }
        }

        //DRAWING
        function draw() {
            //Da sky
            c.fillStyle = 'LightSkyBlue';
            c.fillRect(0, 0, CANVAS_WIDTH, GROUND_Y - 40);

            //Da background
            c.drawImage(backgroundImage, 0, -210);

            //Da ground
            c.fillStyle = 'ForestGreen';
            c.fillRect(0, GROUND_Y - 40, CANVAS_WIDTH, CANVAS_HIEGHT - GROUND_Y + 40);

            c.drawImage(playerImage, playerX, playerY);
        }

    </script>
</body>

</html>